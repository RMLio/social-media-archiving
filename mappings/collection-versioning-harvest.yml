prefixes:
  idlab-fn: "http://example.com/idlab/function/"
  dc: "http://purl.org/dc/elements/1.1/"
  dcterms: "http://purl.org/dc/terms/"
  dcmitype: "http://purl.org/dc/dcmitype/"
  premis: "http://www.loc.gov/premis/rdf/v3/"
  relSubType: "https://id.loc.gov/vocabulary/preservation/relationshipSubType/"
  ebucore: "https://www.ebu.ch/metadata/ontologies/ebucore#"
  schema: "http://schema.org/"
  grel: "http://users.ugent.be/~bjdmeest/function/grel.ttl#"  
  owl: "http://www.w3.org/2002/07/owl#"
  prov: "http://www.w3.org/ns/prov#"
  xsd: "http://www.w3.org/2001/XMLSchema#"
  edm: "http://www.europeana.eu/schemas/edm/"
  bsm: "http://w3id.org/besocial/ns/model#"
  bsd: "http://w3id.org/besocial/data#"
  bss: "http://w3id.org/besocial/ns/shapes#"
  ex: "http://example.org/ns#"

variables:
  access: &dbHost //${SFM_DB_HOST}:${SFM_DB_PORT}/${SFM_DB_DATABASE}
  type: &dbType postgresql
  queryFormulation: &sqlQueryFormulation sql2008
  referenceFormulation: &csvReferenceFormulation csv
  credentials: &credentials
    username: ${SFM_DB_USER}
    password: ${SFM_DB_PASSWORD}

mappings:


  warcs:
    creator: "<Sven.Lieber@ugent.be>"
    description: ""
    version: "v1.0.0"
    sources:
      - access: *dbHost
        type: *dbType
        credentials: *credentials
        queryFormulation: *sqlQueryFormulation
        referenceFormulation: *csvReferenceFormulation
        query: SELECT w.warc_id, w.path, c.collection_id, w.bytes, pg_size_pretty(w.bytes::bigint) as "bytesFormatted", h.harvest_id, (to_char(w.date_created, 'YYYY-MM-DDT') || to_char(w.date_created, 'HH24:MI:SSOF')) as "date_created", to_char(h.date_started, 'YYYYMMDDHH24') as "date_readable" FROM ui_warc w JOIN ui_harvest h ON w.harvest_id=h.id JOIN ui_collection c ON h.collection_id=c.id
    s: bsd:warcJSON_$(warc_id)
    po:
      - [a, prov:Entity]
      - [a, premis:File]
      - [dc:title, "WARC $(warc_id)", en~lang]
      - [dc:description, "The WARC file $(warc_id) of size $(bytesFormatted) generated by harvest $(harvest_id) at $(date_created).", en~lang]
      - [dcterms:identifier, $(warc_id)]
      - [schema:fileSize, $(bytesFormatted)]
      - [premis:size, $(bytes)]
      - [premis:fixity, bsd:warcJSONFixity_$(warc_id)~iri]
      - [premis:originalName, $(path)]
      - [schema:encodingFormat, "application/warc"]
      - [dcterms:format, "application/warc"]
      - [ebucore:hasMimeType, "application/warc"]
      - [dcterms:isPartOf, bsd:collectionVersionJSON_$(collection_id)_$(date_readable)~iri]
      - [relSubType:isp, bsd:collectionVersionJSON_$(collection_id)_$(date_readable)~iri]
      - [prov:generatedAtTime, $(date_created), xsd:dateTime]
      - [prov:wasGeneratedBy, bsd:harvest_$(harvest_id)~iri]


  warcsFixity:
    creator: "<Sven.Lieber@ugent.be>"
    description: ""
    version: "v1.0.0"
    sources:
      - access: *dbHost
        type: *dbType
        credentials: *credentials
        queryFormulation: *sqlQueryFormulation
        referenceFormulation: *csvReferenceFormulation
        query: SELECT w.warc_id, w.sha1 FROM ui_warc w JOIN ui_harvest h ON w.harvest_id=h.id
    s: bsd:warcJSONFixity_$(warc_id)
    po:
      - [a, premis:Fixity]
      - [dc:title, "WARC Fixity $(warc_id)", en~lang]
      - [rdf:value, $(sha1)]
      - [dc:description, "The fixity of WARC file $(warc_id): '$(sha1)'.", en~lang]



  collectionsRepresentationVersion:
    creator: "<Sven.Lieber@ugent.be>"
    description: ""
    version: "v1.0.0"
    sources:
      - access: *dbHost
        type: *dbType
        credentials: *credentials
        queryFormulation: *sqlQueryFormulation
        referenceFormulation: *csvReferenceFormulation
        query: SELECT h.harvest_id, c.collection_id, (to_char(h.date_started, 'YYYY-MM-DDT') || to_char(h.date_started, 'HH24:MI:SSOF')) as "harvest_started", to_char(h.date_started, 'YYYYMMDDHH24') as "date_readable"  FROM ui_harvest h JOIN ui_collection c ON h.collection_id=c.id
    s: bsd:collectionVersionJSON_$(collection_id)_$(date_readable)
    po:
      - [a, edm:WebResource]
      - [a, premis:Representation]
      - [a, bsm:SocialMediaCollectionRepresentationVersion]
      - [dcterms:identifier, $(collection_id)_$(date_readable)]
      - [schema:encodingFormat, "application/json"]
      - [dcterms:format, "application/json"]
      - [ebucore:hasMimeType, "application/json"]
      - [dc:title, "JSON representation of collection $(collection_id) version '$(date_readable)'", en~lang]
      - [dc:description, "The version of this collection in JSON representation created at $(date_readable), including changes of the recent harvest $(harvest_id).", en~lang]
      - [prov:generatedAtTime, $(harvest_started), xsd:dateTime]
      - [prov:specializationOf, bsd:collectionJSON_$(collection_id)~iri]



